---
#- name: install mariadb server package (CentOS)
#  tags: centos,db,mariadb
#  dnf:
#    name: mariadb
#    state: latest
#  when: ansible_distribution == "CentOS"

#- name: install mariadb server
#  tags: db,mariadb,ubuntu
#  apt:
#    name: mariadb-server
#    state: absent
#  when: ansible_distribution == "Ubuntu"

- name: "register facts"
  command: echo "test"
  register: allfacts

# - name: "check allfacts"
#   debug: var=ansible_facts

- debug: var=hostvars[inventory_hostname]['ansible_default_ipv4']['address']

- name: "install mysql-server"
  #gather_facts: false
  package: name={{ item }} state=latest
  with_items:
    - mysql-server
    # - phpmyadmin
    # - php-mbstring
    # - php-zip
    # - php-gd
    # - php-json
    # - php-curl
  when: hostvars[inventory_hostname]['ansible_default_ipv4']['address'] != "192.168.0.148"
 #   - mysql

- name: "start and enable mysql server"
  service:
    name: mysql
    state: started
    enabled: yes

- name: "install pymysql"
  pip:
    name: pymysql
    state: latest

- name: Set MySQL root Password {{ toto_password }}
  tags: db_servers1
  no_log: false
  mysql_user:
#    login_host: 'localhost'
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: 'root'
    login_password: "{{ mysql_root_password | password_hash('sha512','myOwnSalt') }}"
    name: 'root'
    password: "{{ mysql_root_password | password_hash('sha512','myOwnSalt') }}"
    state: present

- name: "create user toto@localhost"
  tags: db_servers1
  no_log: false
  mysql_user:
#    login_host: 'localhost'
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: 'root'
    login_password: "{{ mysql_root_password | password_hash('sha512','myOwnSalt') }}"
    name: 'toto'
    #password: "{{ mysql_toto_password | password_hash('sha512','myOwnSalt') }}"
    password: 'Toto!'
    priv: "*.*:ALL"
    state: present

- name: "create user toto@192.168.0.99"
  tags: db_servers1
  no_log: false
  mysql_user:
#    login_host: 'localhost'
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: 'root'
    login_password: "{{ mysql_root_password | password_hash('sha512','myOwnSalt') }}"
    name: 'toto'
    host: '192.168.0.99'
    #password: "{{ mysql_toto_password | password_hash('sha512','myOwnSalt') }}"
    password: 'Toto!'
    priv: "*.*:ALL"
    state: present

- name: "create user toto@192.168.0.148"
  tags: db_servers1
  no_log: false
  mysql_user:
#    login_host: 'localhost'
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: 'root'
    login_password: "{{ mysql_root_password | password_hash('sha512','myOwnSalt') }}"
    name: 'toto'
    host: '192.168.0.148'
    #password: "{{ mysql_toto_password | password_hash('sha512','myOwnSalt') }}"
    password: 'Toto!'
    priv: "*.*:ALL"
    state: present

# - name: Create mysql database
#   mysql_db:
#     login_unix_socket: /var/run/mysqld/mysqld.sock
#     login_user: 'root'
#     login_password: "{{ toto_password | password_hash('sha512','myOwnSalt') }}"
#     name: projectname
#     state: present 

- name: Create mysql database
  tags: db_servers2
  mysql_db:
    login_unix_socket: /var/run/mysqld/mysqld.sock
    login_user: 'toto'
    login_password: "{{ mysql_toto_password }}"
    name: "mydatabase"
    state: import
    target: /home/toto/monitor/mydatabase.sql



